package net.shyshkin.study.kafka.streams.converters;

import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;

class GsonTwitterFollowersCountExtractorTest {

    @Test
    void extractFollowersCount() {
        //given
        String tweetJson = "{\"created_at\":\"Mon Jul 12 09:07:36 +0000 2021\",\"id\":1414511752948195331,\"id_str\":\"1414511752948195331\",\"text\":\"RT @VVerkopft: Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, was aus irg\\u2026\",\"source\":\"\\u003ca href=\\\"http:\\/\\/twitter.com\\/download\\/android\\\" rel=\\\"nofollow\\\"\\u003eTwitter for Android\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":743118613884833792,\"id_str\":\"743118613884833792\",\"name\":\"Salamander\",\"screen_name\":\"LurchdesJahres\",\"location\":null,\"url\":null,\"description\":null,\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":36,\"friends_count\":263,\"listed_count\":0,\"favourites_count\":28668,\"statuses_count\":1308,\"created_at\":\"Wed Jun 15 16:30:59 +0000 2016\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":false,\"lang\":null,\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"F5F8FA\",\"profile_background_image_url\":\"\",\"profile_background_image_url_https\":\"\",\"profile_background_tile\":false,\"profile_link_color\":\"1DA1F2\",\"profile_sidebar_border_color\":\"C0DEED\",\"profile_sidebar_fill_color\":\"DDEEF6\",\"profile_text_color\":\"333333\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1307118860374609921\\/sQYPhOal_normal.jpg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1307118860374609921\\/sQYPhOal_normal.jpg\",\"profile_banner_url\":\"https:\\/\\/pbs.twimg.com\\/profile_banners\\/743118613884833792\\/1600476335\",\"default_profile\":true,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null,\"withheld_in_countries\":[]},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"retweeted_status\":{\"created_at\":\"Sun Jul 11 16:01:47 +0000 2021\",\"id\":1414253597970378755,\"id_str\":\"1414253597970378755\",\"text\":\"Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, wa\\u2026 https:\\/\\/t.co\\/RBnZJYPLlG\",\"source\":\"\\u003ca href=\\\"https:\\/\\/mobile.twitter.com\\\" rel=\\\"nofollow\\\"\\u003eTwitter Web App\\u003c\\/a\\u003e\",\"truncated\":true,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":1358666496814309376,\"id_str\":\"1358666496814309376\",\"name\":\"verzopft_und_verkopft\",\"screen_name\":\"VVerkopft\",\"location\":null,\"url\":\"https:\\/\\/verkopftundverzopft.wordpress.com\\/blog\\/\",\"description\":\"Kind ist autistisch, deshalb #autismus, #NoABA, #inklusion, au\\u00dferdem #NoCovid.\\nSchreibt gern in Threads. Benutzt Binnen-I und meint damit auch trans.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":235,\"friends_count\":91,\"listed_count\":4,\"favourites_count\":88170,\"statuses_count\":6277,\"created_at\":\"Mon Feb 08 06:38:50 +0000 2021\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":false,\"lang\":null,\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"F5F8FA\",\"profile_background_image_url\":\"\",\"profile_background_image_url_https\":\"\",\"profile_background_tile\":false,\"profile_link_color\":\"1DA1F2\",\"profile_sidebar_border_color\":\"C0DEED\",\"profile_sidebar_fill_color\":\"DDEEF6\",\"profile_text_color\":\"333333\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1382671300267761666\\/oAqx54iZ_normal.jpg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1382671300267761666\\/oAqx54iZ_normal.jpg\",\"profile_banner_url\":\"https:\\/\\/pbs.twimg.com\\/profile_banners\\/1358666496814309376\\/1618493177\",\"default_profile\":true,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null,\"withheld_in_countries\":[]},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"extended_tweet\":{\"full_text\":\"Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, was aus irgendeinem Grund \\\"fehlgelaufen\\\" ist. Sie war schon immer Teil von ABA, der zumindest in den USA verbreitetsten Autismus-\\\"Therapie\\\".\\n\\nEin Thread. Lang. Mit TW.\",\"display_text_range\":[0,280],\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[4,17]}],\"urls\":[],\"user_mentions\":[],\"symbols\":[]}},\"quote_count\":5,\"reply_count\":3,\"retweet_count\":20,\"favorite_count\":52,\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[4,17]}],\"urls\":[{\"url\":\"https:\\/\\/t.co\\/RBnZJYPLlG\",\"expanded_url\":\"https:\\/\\/twitter.com\\/i\\/web\\/status\\/1414253597970378755\",\"display_url\":\"twitter.com\\/i\\/web\\/status\\/1\\u2026\",\"indices\":[117,140]}],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"de\"},\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[19,32]}],\"urls\":[],\"user_mentions\":[{\"screen_name\":\"VVerkopft\",\"name\":\"verzopft_und_verkopft\",\"id\":1358666496814309376,\"id_str\":\"1358666496814309376\",\"indices\":[3,13]}],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"de\",\"timestamp_ms\":\"1626080856917\"}\n";
        var extractor = new GsonTwitterFollowersCountExtractor();

        //when
        var followersCountOptional = extractor.extractFollowersCount(tweetJson);

        //then
        assertThat(followersCountOptional).hasValue(36);

    }

    @Test
    void extractFollowersCount_absentFollowersCount() {
        //given
        String tweetJson = "{\"created_at\":\"Mon Jul 12 09:07:36 +0000 2021\",\"id\":1414511752948195331,\"id_str\":\"1414511752948195331\",\"text\":\"RT @VVerkopft: Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, was aus irg\\u2026\",\"source\":\"\\u003ca href=\\\"http:\\/\\/twitter.com\\/download\\/android\\\" rel=\\\"nofollow\\\"\\u003eTwitter for Android\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":743118613884833792,\"id_str\":\"743118613884833792\",\"name\":\"Salamander\",\"screen_name\":\"LurchdesJahres\",\"location\":null,\"url\":null,\"description\":null,\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"friends_count\":263,\"listed_count\":0,\"favourites_count\":28668,\"statuses_count\":1308,\"created_at\":\"Wed Jun 15 16:30:59 +0000 2016\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":false,\"lang\":null,\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"F5F8FA\",\"profile_background_image_url\":\"\",\"profile_background_image_url_https\":\"\",\"profile_background_tile\":false,\"profile_link_color\":\"1DA1F2\",\"profile_sidebar_border_color\":\"C0DEED\",\"profile_sidebar_fill_color\":\"DDEEF6\",\"profile_text_color\":\"333333\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1307118860374609921\\/sQYPhOal_normal.jpg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1307118860374609921\\/sQYPhOal_normal.jpg\",\"profile_banner_url\":\"https:\\/\\/pbs.twimg.com\\/profile_banners\\/743118613884833792\\/1600476335\",\"default_profile\":true,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null,\"withheld_in_countries\":[]},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"retweeted_status\":{\"created_at\":\"Sun Jul 11 16:01:47 +0000 2021\",\"id\":1414253597970378755,\"id_str\":\"1414253597970378755\",\"text\":\"Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, wa\\u2026 https:\\/\\/t.co\\/RBnZJYPLlG\",\"source\":\"\\u003ca href=\\\"https:\\/\\/mobile.twitter.com\\\" rel=\\\"nofollow\\\"\\u003eTwitter Web App\\u003c\\/a\\u003e\",\"truncated\":true,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":1358666496814309376,\"id_str\":\"1358666496814309376\",\"name\":\"verzopft_und_verkopft\",\"screen_name\":\"VVerkopft\",\"location\":null,\"url\":\"https:\\/\\/verkopftundverzopft.wordpress.com\\/blog\\/\",\"description\":\"Kind ist autistisch, deshalb #autismus, #NoABA, #inklusion, au\\u00dferdem #NoCovid.\\nSchreibt gern in Threads. Benutzt Binnen-I und meint damit auch trans.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":235,\"friends_count\":91,\"listed_count\":4,\"favourites_count\":88170,\"statuses_count\":6277,\"created_at\":\"Mon Feb 08 06:38:50 +0000 2021\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":false,\"lang\":null,\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"F5F8FA\",\"profile_background_image_url\":\"\",\"profile_background_image_url_https\":\"\",\"profile_background_tile\":false,\"profile_link_color\":\"1DA1F2\",\"profile_sidebar_border_color\":\"C0DEED\",\"profile_sidebar_fill_color\":\"DDEEF6\",\"profile_text_color\":\"333333\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1382671300267761666\\/oAqx54iZ_normal.jpg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1382671300267761666\\/oAqx54iZ_normal.jpg\",\"profile_banner_url\":\"https:\\/\\/pbs.twimg.com\\/profile_banners\\/1358666496814309376\\/1618493177\",\"default_profile\":true,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null,\"withheld_in_countries\":[]},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"extended_tweet\":{\"full_text\":\"Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, was aus irgendeinem Grund \\\"fehlgelaufen\\\" ist. Sie war schon immer Teil von ABA, der zumindest in den USA verbreitetsten Autismus-\\\"Therapie\\\".\\n\\nEin Thread. Lang. Mit TW.\",\"display_text_range\":[0,280],\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[4,17]}],\"urls\":[],\"user_mentions\":[],\"symbols\":[]}},\"quote_count\":5,\"reply_count\":3,\"retweet_count\":20,\"favorite_count\":52,\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[4,17]}],\"urls\":[{\"url\":\"https:\\/\\/t.co\\/RBnZJYPLlG\",\"expanded_url\":\"https:\\/\\/twitter.com\\/i\\/web\\/status\\/1414253597970378755\",\"display_url\":\"twitter.com\\/i\\/web\\/status\\/1\\u2026\",\"indices\":[117,140]}],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"de\"},\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[19,32]}],\"urls\":[],\"user_mentions\":[{\"screen_name\":\"VVerkopft\",\"name\":\"verzopft_und_verkopft\",\"id\":1358666496814309376,\"id_str\":\"1358666496814309376\",\"indices\":[3,13]}],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"de\",\"timestamp_ms\":\"1626080856917\"}\n";
        var extractor = new GsonTwitterFollowersCountExtractor();

        //when
        var followersCountOptional = extractor.extractFollowersCount(tweetJson);

        //then
        assertThat(followersCountOptional).isEmpty();

    }

    @Test
    void extractFollowersCount_absentUser() {
        //given
        String tweetJson = "{\"created_at\":\"Mon Jul 12 09:07:36 +0000 2021\",\"id\":1414511752948195331,\"id_str\":\"1414511752948195331\",\"text\":\"RT @VVerkopft: Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, was aus irg\\u2026\",\"source\":\"\\u003ca href=\\\"http:\\/\\/twitter.com\\/download\\/android\\\" rel=\\\"nofollow\\\"\\u003eTwitter for Android\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user_bla_bla\":{\"id\":743118613884833792,\"id_str\":\"743118613884833792\",\"name\":\"Salamander\",\"screen_name\":\"LurchdesJahres\",\"location\":null,\"url\":null,\"description\":null,\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"friends_count\":263,\"listed_count\":0,\"favourites_count\":28668,\"statuses_count\":1308,\"created_at\":\"Wed Jun 15 16:30:59 +0000 2016\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":false,\"lang\":null,\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"F5F8FA\",\"profile_background_image_url\":\"\",\"profile_background_image_url_https\":\"\",\"profile_background_tile\":false,\"profile_link_color\":\"1DA1F2\",\"profile_sidebar_border_color\":\"C0DEED\",\"profile_sidebar_fill_color\":\"DDEEF6\",\"profile_text_color\":\"333333\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1307118860374609921\\/sQYPhOal_normal.jpg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1307118860374609921\\/sQYPhOal_normal.jpg\",\"profile_banner_url\":\"https:\\/\\/pbs.twimg.com\\/profile_banners\\/743118613884833792\\/1600476335\",\"default_profile\":true,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null,\"withheld_in_countries\":[]},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"retweeted_status\":{\"created_at\":\"Sun Jul 11 16:01:47 +0000 2021\",\"id\":1414253597970378755,\"id_str\":\"1414253597970378755\",\"text\":\"Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, wa\\u2026 https:\\/\\/t.co\\/RBnZJYPLlG\",\"source\":\"\\u003ca href=\\\"https:\\/\\/mobile.twitter.com\\\" rel=\\\"nofollow\\\"\\u003eTwitter Web App\\u003c\\/a\\u003e\",\"truncated\":true,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":1358666496814309376,\"id_str\":\"1358666496814309376\",\"name\":\"verzopft_und_verkopft\",\"screen_name\":\"VVerkopft\",\"location\":null,\"url\":\"https:\\/\\/verkopftundverzopft.wordpress.com\\/blog\\/\",\"description\":\"Kind ist autistisch, deshalb #autismus, #NoABA, #inklusion, au\\u00dferdem #NoCovid.\\nSchreibt gern in Threads. Benutzt Binnen-I und meint damit auch trans.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":235,\"friends_count\":91,\"listed_count\":4,\"favourites_count\":88170,\"statuses_count\":6277,\"created_at\":\"Mon Feb 08 06:38:50 +0000 2021\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":false,\"lang\":null,\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"F5F8FA\",\"profile_background_image_url\":\"\",\"profile_background_image_url_https\":\"\",\"profile_background_tile\":false,\"profile_link_color\":\"1DA1F2\",\"profile_sidebar_border_color\":\"C0DEED\",\"profile_sidebar_fill_color\":\"DDEEF6\",\"profile_text_color\":\"333333\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1382671300267761666\\/oAqx54iZ_normal.jpg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1382671300267761666\\/oAqx54iZ_normal.jpg\",\"profile_banner_url\":\"https:\\/\\/pbs.twimg.com\\/profile_banners\\/1358666496814309376\\/1618493177\",\"default_profile\":true,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null,\"withheld_in_countries\":[]},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"extended_tweet\":{\"full_text\":\"Bei #StopTheShock geht es um die Elektroschocks an Autisten am Judge Rotenberg Center.\\n\\nDiese Gewalt ist nichts, was aus irgendeinem Grund \\\"fehlgelaufen\\\" ist. Sie war schon immer Teil von ABA, der zumindest in den USA verbreitetsten Autismus-\\\"Therapie\\\".\\n\\nEin Thread. Lang. Mit TW.\",\"display_text_range\":[0,280],\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[4,17]}],\"urls\":[],\"user_mentions\":[],\"symbols\":[]}},\"quote_count\":5,\"reply_count\":3,\"retweet_count\":20,\"favorite_count\":52,\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[4,17]}],\"urls\":[{\"url\":\"https:\\/\\/t.co\\/RBnZJYPLlG\",\"expanded_url\":\"https:\\/\\/twitter.com\\/i\\/web\\/status\\/1414253597970378755\",\"display_url\":\"twitter.com\\/i\\/web\\/status\\/1\\u2026\",\"indices\":[117,140]}],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"de\"},\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[{\"text\":\"StopTheShock\",\"indices\":[19,32]}],\"urls\":[],\"user_mentions\":[{\"screen_name\":\"VVerkopft\",\"name\":\"verzopft_und_verkopft\",\"id\":1358666496814309376,\"id_str\":\"1358666496814309376\",\"indices\":[3,13]}],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"de\",\"timestamp_ms\":\"1626080856917\"}\n";
        var extractor = new GsonTwitterFollowersCountExtractor();

        //when
        var followersCountOptional = extractor.extractFollowersCount(tweetJson);

        //then
        assertThat(followersCountOptional).isEmpty();
    }
}